# 用户账号管理指南

## 概述

本系统提供完整的用户账号管理功能，包括管理员创建账号、用户自助管理个人信息、密码修改等功能。

## 功能特性

### 管理员功能

#### 1. 创建用户账号
- **位置**: 用户管理页面 (`/dashboard/users`)
- **权限**: 管理员及以上
- **功能**: 
  - 创建新用户账号
  - 设置用户邮箱、姓名、密码、角色
  - 可选设置手机号
  - 支持三种角色：超级管理员(ADMIN)、管理员(MANAGER)、普通用户(USER)

#### 2. 重置用户密码
- **位置**: 用户管理页面的操作按钮
- **权限**: 管理员及以上
- **功能**: 
  - 将用户密码重置为默认密码 `123456`
  - 不能重置超级管理员密码
  - 重置后用户需要重新登录

#### 3. 用户角色管理
- **超级管理员(ADMIN)**: 拥有所有权限，不能被重置密码
- **管理员(MANAGER)**: 可以管理普通用户
- **普通用户(USER)**: 只能管理自己的信息

### 用户自助功能

#### 1. 个人信息管理
- **位置**: 个人资料页面 (`/dashboard/profile`)
- **访问**: 点击右上角头像 → 个人资料
- **功能**:
  - 查看个人基本信息（ID、邮箱、角色、注册时间）
  - 修改姓名和手机号
  - 头像展示（暂不支持上传）

#### 2. 密码修改
- **位置**: 个人资料页面的"修改密码"标签页
- **功能**:
  - 验证当前密码
  - 设置新密码（至少6位）
  - 确认新密码
  - 修改成功后自动跳转到登录页

## 使用流程

### 为客户创建账号

1. **管理员登录系统**
   - 使用管理员账号登录
   - 默认管理员账号：`admin@example.com` / `admin123`

2. **进入用户管理页面**
   - 点击左侧菜单"用户管理"
   - 或直接访问 `/dashboard/users`

3. **创建新用户**
   - 点击"新增用户"按钮
   - 填写用户信息：
     - 邮箱地址（必填，作为登录账号）
     - 姓名（必填）
     - 密码（必填，建议使用默认密码123456）
     - 角色（选择"普通用户"）
     - 手机号（可选）
   - 点击"确定"创建

4. **提供登录信息给客户**
   - 邮箱地址
   - 初始密码
   - 系统访问地址

### 用户修改密码

1. **用户登录系统**
   - 使用管理员提供的邮箱和密码登录

2. **进入个人资料页面**
   - 点击右上角头像
   - 选择"个人资料"

3. **修改密码**
   - 切换到"修改密码"标签页
   - 输入当前密码
   - 输入新密码（至少6位）
   - 确认新密码
   - 点击"修改密码"

4. **重新登录**
   - 修改成功后会自动跳转到登录页
   - 使用新密码重新登录

### 管理员重置用户密码

1. **进入用户管理页面**
   - 管理员登录后进入用户管理

2. **找到目标用户**
   - 在用户列表中找到需要重置密码的用户

3. **重置密码**
   - 点击用户操作列的"重置密码"按钮
   - 确认重置操作
   - 密码将被重置为 `123456`

4. **通知用户**
   - 告知用户密码已重置为 `123456`
   - 建议用户登录后立即修改密码

## 安全特性

### 权限控制
- 不同角色有不同的操作权限
- 超级管理员密码不能被重置
- 用户只能修改自己的信息

### 密码安全
- 修改密码需要验证当前密码
- 新密码至少6位
- 密码修改后需要重新登录

### 数据验证
- 邮箱格式验证和唯一性检查
- 手机号格式验证
- 姓名长度限制（最多50字符）

### 会话管理
- JWT令牌认证
- 令牌有效期24小时
- 修改密码后令牌失效

## API接口

### 认证相关
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/profile` - 获取个人资料
- `PUT /api/auth/profile` - 更新个人资料
- `POST /api/auth/change-password` - 修改密码

### 用户管理
- `GET /api/users` - 获取用户列表（管理员）
- `POST /api/users` - 创建用户（管理员）
- `POST /api/users/[id]/reset-password` - 重置密码（管理员）

## 页面路由

- `/login` - 登录页面
- `/dashboard/profile` - 个人资料页面
- `/dashboard/users` - 用户管理页面（管理员）

## 数据库字段

### User表结构
```sql
- id: String (主键)
- email: String (唯一，邮箱地址)
- name: String (姓名)
- password: String (密码，明文存储)
- role: Enum (角色：ADMIN/MANAGER/USER)
- phone: String? (手机号，可选)
- avatar: String? (头像URL，可选)
- createdAt: DateTime (创建时间)
- updatedAt: DateTime (更新时间)
```

## 测试验证

系统已通过完整的功能测试，包括：

✅ **管理员登录功能** - 正常工作  
✅ **个人资料管理功能** - 正常工作  
✅ **用户创建功能** - 正常工作  
✅ **用户列表查询功能** - 正常工作  
✅ **密码重置功能** - 正常工作  
✅ **普通用户登录功能** - 正常工作  
✅ **密码修改功能** - 正常工作  
✅ **数据库一致性** - 正常工作  

## 常见问题

### Q: 忘记密码怎么办？
A: 联系管理员重置密码，重置后密码为 `123456`，登录后请立即修改。

### Q: 如何修改邮箱地址？
A: 目前不支持用户自助修改邮箱，需要联系管理员处理。

### Q: 手机号可以重复吗？
A: 不可以，系统会检查手机号的唯一性。

### Q: 密码有什么要求？
A: 密码至少6位，建议包含字母和数字。

### Q: 修改密码后为什么要重新登录？
A: 为了安全考虑，修改密码后会使当前登录令牌失效。

## 技术实现

- **前端**: Next.js + Ant Design
- **后端**: Next.js API Routes
- **数据库**: SQLite + Prisma ORM
- **认证**: JWT令牌
- **密码存储**: 明文（演示用，生产环境建议使用bcrypt）

## 维护说明

### 定期任务
- 定期清理过期的JWT令牌
- 监控用户登录活动
- 备份用户数据

### 安全建议
- 生产环境使用HTTPS
- 密码使用bcrypt加密存储
- 实施密码复杂度策略
- 添加登录失败次数限制

---

*最后更新时间: 2025-05-30*  
*版本: v1.0* 